<div [class.dark]="theme.isDark()">
  <div class="min-h-screen bg-stone-50 dark:bg-stone-900 transition-colors">
  <!-- Navegación -->
  <header class="border-b border-stone-200 dark:border-stone-700 bg-white/80 dark:bg-stone-800/80 backdrop-blur-sm sticky top-0 z-10 transition-colors">
    <nav class="max-w-5xl mx-auto px-4 py-1.5 flex items-center justify-between">
      <a routerLink="/" (click)="closeMobileMenu()" class="text-base font-semibold text-stone-800 dark:text-stone-100 tracking-tight shrink-0">
        {{ brand.appName }}
      </a>

      <!-- Escritorio: enlaces en fila -->
      <div class="hidden md:flex items-center gap-3">
        <a routerLink="/miembros" routerLinkActive="!text-amber-700 !dark:text-amber-300 font-semibold bg-amber-50 dark:bg-amber-900/30"
           [routerLinkActiveOptions]="{ exact: false }"
           class="text-sm text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 transition-colors py-1 px-3 rounded-lg">
          Miembros
        </a>
        <a routerLink="/agenda" routerLinkActive="!text-amber-700 !dark:text-amber-300 font-semibold bg-amber-50 dark:bg-amber-900/30"
           [routerLinkActiveOptions]="{ exact: false }"
           class="text-sm text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 transition-colors py-1 px-3 rounded-lg">
          Agenda Mensual
        </a>
        <a routerLink="/canciones" routerLinkActive="!text-amber-700 !dark:text-amber-300 font-semibold bg-amber-50 dark:bg-amber-900/30"
           [routerLinkActiveOptions]="{ exact: false }"
           class="text-sm text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 transition-colors py-1 px-3 rounded-lg">
          Canciones
        </a>
        <a routerLink="/calendario" routerLinkActive="!text-amber-700 !dark:text-amber-300 font-semibold bg-amber-50 dark:bg-amber-900/30"
           [routerLinkActiveOptions]="{ exact: false }"
           class="text-sm text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 transition-colors py-1 px-3 rounded-lg">
          Calendario El Camino
        </a>
        @if (adminAuth.isAdmin()) {
          <button type="button"
                  (click)="logoutAdmin()"
                  [attr.aria-label]="'Cerrar sesión (admin)'"
                  [attr.title]="'Cerrar sesión (admin)'"
                  class="rounded-lg p-1.5 text-amber-600 dark:text-amber-400 hover:bg-amber-50 dark:hover:bg-amber-900/20 transition-colors">
            <span class="inline-block w-4 h-4" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </span>
          </button>
        } @else {
          <button type="button"
                  (click)="openAdminModal()"
                  aria-label="Acceso administrador"
                  title="Acceso administrador"
                  class="rounded-lg p-1.5 text-stone-500 dark:text-stone-400 hover:text-stone-700 dark:hover:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700/50 transition-colors">
            <span class="inline-block w-4 h-4" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </span>
          </button>
        }
        <button type="button"
                (click)="theme.toggle()"
                [attr.aria-label]="theme.isDark() ? 'Activar modo claro' : 'Activar modo oscuro'"
                class="rounded-lg p-1.5 text-stone-600 dark:text-stone-400 hover:bg-stone-200 dark:hover:bg-stone-700 transition-colors">
          @if (theme.isDark()) {
            <i class="fi fi-rr-sun text-lg" aria-hidden="true"></i>
          } @else {
            <i class="fi fi-rr-moon text-lg" aria-hidden="true"></i>
          }
        </button>
      </div>

      <!-- Móvil: botón hamburguesa + tema -->
      <div class="flex md:hidden items-center gap-1">
        <button type="button"
                (click)="theme.toggle()"
                [attr.aria-label]="theme.isDark() ? 'Activar modo claro' : 'Activar modo oscuro'"
                class="rounded-lg p-2 text-stone-600 dark:text-stone-400 hover:bg-stone-200 dark:hover:bg-stone-700 transition-colors">
          @if (theme.isDark()) {
            <i class="fi fi-rr-sun text-xl" aria-hidden="true"></i>
          } @else {
            <i class="fi fi-rr-moon text-xl" aria-hidden="true"></i>
          }
        </button>
        <button type="button"
                (click)="toggleMobileMenu()"
                [attr.aria-label]="mobileMenuOpen() ? 'Cerrar menú' : 'Abrir menú'"
                [attr.aria-expanded]="mobileMenuOpen()"
                class="rounded-lg p-2 text-stone-600 dark:text-stone-400 hover:bg-stone-200 dark:hover:bg-stone-700 transition-colors">
          @if (mobileMenuOpen()) {
            <span class="text-xl leading-none" aria-hidden="true">✕</span>
          } @else {
            <span class="flex flex-col gap-1" aria-hidden="true">
              <span class="block w-5 h-0.5 bg-current rounded"></span>
              <span class="block w-5 h-0.5 bg-current rounded"></span>
              <span class="block w-5 h-0.5 bg-current rounded"></span>
            </span>
          }
        </button>
      </div>
    </nav>

    <!-- Menú móvil desplegable -->
    @if (mobileMenuOpen()) {
      <div class="md:hidden border-t border-stone-200 dark:border-stone-700 bg-white dark:bg-stone-800/95 backdrop-blur-sm">
        <div class="max-w-5xl mx-auto px-4 py-2 flex flex-col gap-0.5">
          <a routerLink="/miembros" (click)="closeMobileMenu()"
             routerLinkActive="!text-amber-700 !dark:text-amber-300 font-semibold bg-amber-50 dark:bg-amber-900/30"
             [routerLinkActiveOptions]="{ exact: false }"
             class="py-2 px-3 rounded-lg text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700/50 transition-colors">
            Miembros
          </a>
          <a routerLink="/agenda" (click)="closeMobileMenu()"
             routerLinkActive="!text-amber-700 !dark:text-amber-300 font-semibold bg-amber-50 dark:bg-amber-900/30"
             [routerLinkActiveOptions]="{ exact: false }"
             class="py-2 px-3 rounded-lg text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700/50 transition-colors">
            Agenda Mensual
          </a>
          <a routerLink="/canciones" (click)="closeMobileMenu()"
             routerLinkActive="!text-amber-700 !dark:text-amber-300 font-semibold bg-amber-50 dark:bg-amber-900/30"
             [routerLinkActiveOptions]="{ exact: false }"
             class="py-2 px-3 rounded-lg text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700/50 transition-colors">
            Canciones
          </a>
          <a routerLink="/calendario" (click)="closeMobileMenu()"
             routerLinkActive="!text-amber-700 !dark:text-amber-300 font-semibold bg-amber-50 dark:bg-amber-900/30"
             [routerLinkActiveOptions]="{ exact: false }"
             class="py-2 px-3 rounded-lg text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700/50 transition-colors">
            Calendario El Camino
          </a>
          @if (adminAuth.isAdmin()) {
            <button type="button"
                    (click)="logoutAdmin(); closeMobileMenu()"
                    class="py-2 px-3 rounded-lg text-left text-sm font-medium text-amber-600 dark:text-amber-400 hover:bg-stone-100 dark:hover:bg-stone-700/50 transition-colors flex items-center gap-2">
              <span class="inline-block w-4 h-4 shrink-0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></span>
              Salir (admin)
            </button>
          } @else {
            <button type="button"
                    (click)="openAdminModal(); closeMobileMenu()"
                    class="py-2 px-3 rounded-lg text-left text-sm font-medium text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700/50 transition-colors flex items-center gap-2">
              <span class="inline-block w-4 h-4 shrink-0 opacity-70"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></span>
              Admin
            </button>
          }
        </div>
      </div>
    }
  </header>

  <!-- Contenido principal -->
  <main class="max-w-5xl mx-auto px-4 pt-4 pb-6">
    <router-outlet />
  </main>

  <!-- Botón ir arriba -->
  @if (showBackToTop()) {
    <button type="button"
            (click)="scrollToTop()"
            aria-label="Volver arriba"
            title="Volver arriba"
            class="fixed bottom-6 right-6 z-20 flex h-11 w-11 items-center justify-center rounded-full border border-stone-200 dark:border-stone-600 bg-white dark:bg-stone-800 text-stone-600 dark:text-stone-300 shadow-lg hover:bg-amber-50 hover:border-amber-300 hover:text-amber-700 dark:hover:bg-amber-900/30 dark:hover:border-amber-600 dark:hover:text-amber-300 transition-colors">
      <i class="fi fi-rr-angle-up text-xl" aria-hidden="true"></i>
    </button>
  }

  <!-- Modal acceso administrador -->
  @if (showAdminModal()) {
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4"
         role="dialog"
         aria-modal="true"
         aria-labelledby="admin-modal-title">
      <div class="fixed inset-0 bg-black/50" (click)="closeAdminModal()"></div>
      <div class="relative z-10 w-full max-w-sm rounded-2xl border border-stone-200 dark:border-stone-600 bg-white dark:bg-stone-800 p-6 shadow-xl">
        <h2 id="admin-modal-title" class="text-lg font-semibold text-stone-800 dark:text-stone-100">Acceso administrador</h2>
        <p class="mt-1 text-sm text-stone-500 dark:text-stone-400">Ingresa la contraseña para editar canciones, agenda y calendario.</p>
        <div class="mt-4">
          <label for="admin-password" class="block text-xs font-medium text-stone-500 dark:text-stone-400 mb-1">Contraseña</label>
          <input id="admin-password"
                 type="password"
                 [ngModel]="adminPassword()"
                 (ngModelChange)="adminPassword.set($event); adminError.set(false)"
                 (keydown.enter)="submitAdminLogin()"
                 placeholder="Contraseña"
                 class="w-full rounded-lg border border-stone-200 dark:border-stone-600 bg-stone-50 dark:bg-stone-700 px-3 py-2 text-stone-800 dark:text-stone-200 focus:border-amber-500 focus:outline-none focus:ring-1 focus:ring-amber-500"
                 autocomplete="current-password">
          @if (adminError()) {
            <p class="mt-2 text-sm text-red-600 dark:text-red-400">Contraseña incorrecta.</p>
          }
        </div>
        <div class="mt-4 flex justify-end gap-2">
          <button type="button"
                  (click)="closeAdminModal()"
                  class="rounded-lg border border-stone-200 dark:border-stone-600 px-4 py-2 text-sm font-medium text-stone-700 dark:text-stone-300 hover:bg-stone-100 dark:hover:bg-stone-700">
            Cancelar
          </button>
          <button type="button"
                  (click)="submitAdminLogin()"
                  class="rounded-lg bg-amber-600 px-4 py-2 text-sm font-medium text-white hover:bg-amber-700">
            Entrar
          </button>
        </div>
      </div>
    </div>
  }
  </div>
</div>
